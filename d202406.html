<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="generator" content="pandoc">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
                <title>2024年6月</title>
    <style type="text/css">
      code {
        white-space: pre;
      }
    </style>
        <style type="text/css"></style>

    <link rel="stylesheet" href="style.css" type="text/css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- link rel="stylesheet" href="github-markdown.css" type="text/css" / -->
          </head>

  <body>
    <article class="markdown-body">
                        <h1 id="年6月">2024年6月</h1>
                        <h2 id="月04日火"><a href="#04">06月04日(火)</a> <a id="04"></a></h2>
                        <p>数理物理の録画を確認したが、音が駄目だった。ワイヤレスマイクが必要。RODE Wireless GOが良いらしいが、さすがに高い(4万〜5万)。いろいろ調べてサンワダイレクトの400-MCW001を頼んでみた。</p>
                        <p>メモ。古い環境でPython仮想環境を構築する方法。pip無しで仮想環境を構築してから、後でpipをローカルにインストールする。</p>
                        <div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="ex">python3</span> -m venv myenv --without-pip  </span>
                        <span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="bu">source</span> myenv/bin/activate </span>
                        <span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="fu">wget</span> https://bootstrap.pypa.io/pip/3.6/get-pip.py</span>
                        <span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a><span class="ex">python3</span> get-pip.py</span></code></pre></div>
                        <p>NumPyが裏でなんスレッド使っているか確認。<code>threadpoolctl</code>をインストール。</p>
                        <div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="ex">python3</span> -m pip install threadpoolctl ipython</span></code></pre></div>
                        <p>ipython3上で以下を実行。</p>
                        <div class="sourceCode" id="cb3"><pre class="sourceCode txt"><code class="sourceCode default"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a>from threadpoolctl import threadpool_info</span>
                        <span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a>import numpy as np</span>
                        <span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a>threadpool_info()</span></code></pre></div>
                        <p>計算ノード。</p>
                        <div class="sourceCode" id="cb4"><pre class="sourceCode txt"><code class="sourceCode default"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a>[{&#39;user_api&#39;: &#39;blas&#39;,</span>
                        <span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a>  &#39;internal_api&#39;: &#39;openblas&#39;,</span>
                        <span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>  &#39;prefix&#39;: &#39;libopenblas&#39;,</span>
                        <span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a>  &#39;filepath&#39;: &#39;/home/watanabe/github/simple_rbm/myenv/lib/python3.6/site-packages/numpy.libs/libopenblasp-r0-09e95953.3.13.so&#39;,</span>
                        <span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a>  &#39;version&#39;: &#39;0.3.13&#39;,</span>
                        <span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a>  &#39;threading_layer&#39;: &#39;pthreads&#39;,</span>
                        <span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a>  &#39;architecture&#39;: &#39;SkylakeX&#39;,</span>
                        <span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a>  &#39;num_threads&#39;: 40}]</span></code></pre></div>
                        <p>AMD EPYC</p>
                        <div class="sourceCode" id="cb5"><pre class="sourceCode txt"><code class="sourceCode default"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a>[{&#39;user_api&#39;: &#39;blas&#39;,</span>
                        <span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a>  &#39;internal_api&#39;: &#39;openblas&#39;,</span>
                        <span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a>  &#39;prefix&#39;: &#39;libopenblas&#39;,</span>
                        <span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a>  &#39;filepath&#39;: &#39;/home/watanabe/github/simple_rbm/myenv/lib/python3.6/site-packages/numpy.libs/libopenblasp-r0-09e95953.3.13.so&#39;,</span>
                        <span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a>  &#39;version&#39;: &#39;0.3.13&#39;,</span>
                        <span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a>  &#39;threading_layer&#39;: &#39;pthreads&#39;,</span>
                        <span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a>  &#39;architecture&#39;: &#39;Zen&#39;,</span>
                        <span id="cb5-8"><a href="#cb5-8" aria-hidden="true"></a>  &#39;num_threads&#39;: 32}]</span></code></pre></div>
                        <p>Mac。</p>
                        <div class="sourceCode" id="cb6"><pre class="sourceCode txt"><code class="sourceCode default"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a>[{&#39;user_api&#39;: &#39;blas&#39;,</span>
                        <span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a>  &#39;internal_api&#39;: &#39;openblas&#39;,</span>
                        <span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a>  &#39;num_threads&#39;: 10,</span>
                        <span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a>  &#39;prefix&#39;: &#39;libopenblas&#39;,</span>
                        <span id="cb6-5"><a href="#cb6-5" aria-hidden="true"></a>  &#39;filepath&#39;: &#39;/Users/watanabe/github/simple_rbm/myenv/lib/python3.12/site-packages/numpy/.dylibs/libopenblas64_.0.dylib&#39;,</span>
                        <span id="cb6-6"><a href="#cb6-6" aria-hidden="true"></a>  &#39;version&#39;: &#39;0.3.23.dev&#39;,</span>
                        <span id="cb6-7"><a href="#cb6-7" aria-hidden="true"></a>  &#39;threading_layer&#39;: &#39;pthreads&#39;,</span>
                        <span id="cb6-8"><a href="#cb6-8" aria-hidden="true"></a>  &#39;architecture&#39;: &#39;Haswell&#39;}]</span></code></pre></div>
                        <p>OpenBLASのスレッド数設定は<code>OPENBLAS_NUM_THREADS</code>だそうな。なので、NumPyが裏で使うスレッド数を設定するには、</p>
                        <div class="sourceCode" id="cb7"><pre class="sourceCode py"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a>OPENBLAS_NUM_THREADS<span class="op">=</span><span class="dv">1</span> python3 hoge.py</span></code></pre></div>
                        <p>などとすれば良い。<code>OMP_NUM_THREADS</code>じゃないのか・・・。</p>
                        <p>2024年度 理工学部 教授・准教授就任講演。僕はトップバッター。今回はちゃんとネクタイをした。</p>
                        <h2 id="月03日月"><a href="#03">06月03日(月)</a> <a id="03"></a></h2>
                        <p>数理物理第一回。とりあえずなんとか終えた。</p>
                        <p>録画もしたが、音が厳しいな。やはりワイヤレスマイクから入力する必要がある。買うか。</p>
                        <p>明日も発表があるんだよな・・・</p>
                        <p>数理物理の試験形態入力済ませた。</p>
                        <h2 id="月02日日"><a href="#02">06月02日(日)</a> <a id="02"></a></h2>
                        <p>数理物理の講義予習。黒板ガリガリ1時間半は体力を消耗する。これが週２日はきつい。</p>
                        <h2 id="月01日土"><a href="#01">06月01日(土)</a> <a id="01"></a></h2>
                        <p>NOP</p>
          </article>
  </body>

  </html>