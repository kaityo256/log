<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="generator" content="pandoc">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
                <title>d202109</title>
    <style type="text/css">
      code {
        white-space: pre;
      }
    </style>
        <style type="text/css"></style>

    <link rel="stylesheet" href="style.css" type="text/css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- link rel="stylesheet" href="github-markdown.css" type="text/css" / -->
          </head>

  <body>
    <article class="markdown-body">
                        <h1 id="ログ">ログ</h1>
<p><a href="index.html">ログ一覧</a></p>
<h2 id="月14日火"><a href="#14">09月14日(火)</a> <a id="14"></a></h2>
<p>朝から発表会。その後会議。メール処理。</p>
<p>なんかぼーっとしてしまう。</p>
<h2 id="月13日月"><a href="#13">09月13日(月)</a> <a id="13"></a></h2>
<p>いろいろ忙しい。学会発表来週か。いつスライド作るんだ？</p>
<p>10月1日までには、最低でも2つ講義ビデオを録画しておかないといけない。10月5日までにプログラミング基礎同演習の講義を最低1つ、できれば2つ録画しておきたい。</p>
<p>わりとスケジュール破綻してない？とにかくGitHub演習の講義作らないといろいろ進まないぞ。</p>
<h2 id="月12日日"><a href="#12">09月12日(日)</a> <a id="12"></a></h2>
<p>講義の準備がほとんとできず。子供の相手をして疲れた。体が重い。</p>
<h2 id="月11日土"><a href="#11">09月11日(土)</a> <a id="11"></a></h2>
<p>講義の準備。ブランチ操作をあらかた書いたことにする。</p>
<h2 id="月10日金"><a href="#10">09月10日(金)</a> <a id="10"></a></h2>
<p>certbotがエラーを出している。</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode txt"><code class="sourceCode default"><a class="sourceLine" id="cb1-1" title="1">Your system is not supported by certbot-auto anymore.</a></code></pre></div>
<p>ログインして確認。</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" title="1">$ <span class="fu">sudo</span> certbot renew --dry-run</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">(</span><span class="ex">snip</span><span class="kw">)</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="ex">All</span> renewal attempts failed. The following certs could not be renewed:</a>
<a class="sourceLine" id="cb2-4" title="4"><span class="kw">(</span><span class="ex">snip</span><span class="kw">)</span></a></code></pre></div>
<p>おっと。なんかバージョンが古いのが問題らしい。</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" title="1">$ <span class="ex">certbot</span> --version</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="ex">certbot</span> 0.31.0</a></code></pre></div>
<p>バージョンをあげてみる。</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb4-1" title="1"><span class="ex">yum</span> install --enablerepo=epel certbot</a></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb5-1" title="1">$ <span class="ex">certbot</span> --version</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="ex">An</span> unexpected error occurred:</a>
<a class="sourceLine" id="cb5-3" title="3"><span class="ex">AttributeError</span>: <span class="st">&#39;module&#39;</span> object has no attribute <span class="st">&#39;TLSSNI01&#39;</span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="ex">Please</span> see the logfile <span class="st">&#39;/tmp/tmpjRf06l/log&#39;</span> for more details.</a></code></pre></div>
<p>うげ、バージョンを上げたら動かなくなったぞ。python2-certbotをアップデートすれば良いらしい。</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb6-1" title="1"><span class="fu">sudo</span> yum update python2-certbot*</a></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb7-1" title="1">$ <span class="ex">certbot</span> --version</a>
<a class="sourceLine" id="cb7-2" title="2"><span class="ex">certbot</span> 1.11.0</a></code></pre></div>
<p>よしよし、動いた。</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb8-1" title="1">$ <span class="fu">sudo</span> certbot renew --dry-run</a>
<a class="sourceLine" id="cb8-2" title="2"><span class="kw">(</span><span class="ex">snip</span><span class="kw">)</span></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="ex">Congratulations</span>, all simulated renewals succeeded:</a></code></pre></div>
<p>動いた。よかった。焦った。</p>
<h2 id="月09日木"><a href="#09">09月09日(木)</a> <a id="09"></a></h2>
<p>本の購入。</p>
<p>プレ技の発表練習。輪講。一冊読み終わった。素晴らしい。そして浸透圧について何もわかっていなかったことがわかった。</p>
<p>なんか呆然としてしまって、手が動かないぞ。</p>
<p>学校のPCにsnapを入れる確認。</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb9-1" title="1">$ <span class="fu">which</span> snap</a>
<a class="sourceLine" id="cb9-2" title="2"><span class="ex">/usr/bin/snap</span></a></code></pre></div>
<p>snapはデフォルトで入っている。しかし、そのままでは返答しない。</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb10-1" title="1"><span class="ex">snap</span> --version <span class="co"># 処理が返ってこない。</span></a></code></pre></div>
<p>というわけでsnapを入れる。まだ時間が遅れてたので、まず直す。</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb11-1" title="1"><span class="fu">sudo</span> hwclock -s</a></code></pre></div>
<p>daemonize dbus-user-session fontconfigの三つをインストール。</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb12-1" title="1"><span class="fu">sudo</span> apt-get update</a>
<a class="sourceLine" id="cb12-2" title="2"><span class="fu">sudo</span> apt-get install -yqq daemonize dbus-user-session fontconfig</a></code></pre></div>
<p>demonizeを起動。</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb13-1" title="1"><span class="fu">sudo</span> daemonize /usr/bin/unshare --fork --pid --mount-proc /lib/systemd/systemd --system-unit=basic.target</a></code></pre></div>
<p>snapが返事をするようになる。</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb14-1" title="1">$ <span class="ex">snap</span> version</a>
<a class="sourceLine" id="cb14-2" title="2"><span class="ex">snap</span>    2.48.3+20.04</a>
<a class="sourceLine" id="cb14-3" title="3"><span class="ex">snapd</span>   2.48.3+20.04</a>
<a class="sourceLine" id="cb14-4" title="4"><span class="ex">series</span>  16</a>
<a class="sourceLine" id="cb14-5" title="5"><span class="ex">ubuntu</span>  20.04</a>
<a class="sourceLine" id="cb14-6" title="6"><span class="ex">kernel</span>  4.19.128-microsoft-standard</a></code></pre></div>
<p>ログインしていないと、listなどが見られない。</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb15-1" title="1">$ <span class="ex">snap</span> list</a>
<a class="sourceLine" id="cb15-2" title="2"><span class="ex">error</span>: access denied (try with sudo)</a></code></pre></div>
<p>sudoを試せと言ってくるが、listを見るにはroot権限は不要で、ログインが必要。この状態でsudoしてもダメと言われる。</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb16-1" title="1">$ <span class="fu">sudo</span> snap list</a>
<a class="sourceLine" id="cb16-2" title="2"><span class="ex">error</span>: access denied (see <span class="st">&#39;snap help login&#39;</span>)</a></code></pre></div>
<p>ログインしようとしたら以下のコマンドで死ぬ。</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb17-1" title="1"><span class="bu">exec</span> sudo nsenter -t <span class="va">$(</span><span class="fu">pidof</span> systemd<span class="va">)</span> -a su - <span class="va">$LOGNAME</span></a></code></pre></div>
<p>調べてみると、systemdが二つ動いている。</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb18-1" title="1">$ <span class="fu">pidof</span> systemd</a>
<a class="sourceLine" id="cb18-2" title="2"><span class="ex">32692</span> 30864</a></code></pre></div>
<p>ssh-agentはたくさん動いてる。</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb19-1" title="1">$ <span class="fu">pidof</span> ssh-agent</a>
<a class="sourceLine" id="cb19-2" title="2"><span class="ex">33686</span> 33657 33572 32677 29135 28925 27485 24655 24530 23881 16910 10516 13</a></code></pre></div>
<p>再起動してみるかな。PowerShellから</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb20-1" title="1"><span class="ex">wsl</span> --shutdown</a></code></pre></div>
<p>を実行。</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb21-1" title="1">$ <span class="fu">pidof</span> ssh-agent</a>
<a class="sourceLine" id="cb21-2" title="2"><span class="ex">16</span></a>
<a class="sourceLine" id="cb21-3" title="3">$ <span class="fu">pidof</span> systemd</a></code></pre></div>
<p>ssh-agentが一つ、systemdは動いていない状態になった。demonizeでsystemdを起動。</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb22-1" title="1"><span class="fu">sudo</span> daemonize /usr/bin/unshare --fork --pid --mount-proc /lib/systemd/systemd --system-unit=basic.target</a></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb23-1" title="1">$ <span class="fu">pidof</span> systemd</a>
<a class="sourceLine" id="cb23-2" title="2"><span class="ex">262</span></a></code></pre></div>
<p>うん、一つになった。snapにログインする。</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb24-1" title="1"><span class="bu">exec</span> sudo nsenter -t <span class="va">$(</span><span class="fu">pidof</span> systemd<span class="va">)</span> -a su - <span class="va">$LOGNAME</span></a></code></pre></div>
<p>できた。</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb25-1" title="1">$ <span class="ex">snap</span> list</a>
<a class="sourceLine" id="cb25-2" title="2"><span class="ex">Name</span>    Version   Rev    Tracking       Publisher   Notes</a>
<a class="sourceLine" id="cb25-3" title="3"><span class="ex">core18</span>  20200707  1880   latest/stable  canonical✓  base</a>
<a class="sourceLine" id="cb25-4" title="4"><span class="ex">lxd</span>     4.0.2     16558  4.0/stable/…   canonical✓  -</a>
<a class="sourceLine" id="cb25-5" title="5"><span class="ex">snapd</span>   2.45.2    8542   latest/stable  canonical✓  snapd</a></code></pre></div>
<p>実行できた。</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb26-1" title="1">$ <span class="ex">snap</span> search pdftk</a>
<a class="sourceLine" id="cb26-2" title="2"><span class="ex">pdftk</span>  2.02-4   smoser     -      command-line tool for working with PDF files</a></code></pre></div>
<p>pdftkを見つけた。インストールする(rootが必要)。</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb27-1" title="1"><span class="fu">sudo</span> snap install pdftk</a></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb28-1" title="1">$ <span class="ex">pdftk</span> --version</a>
<a class="sourceLine" id="cb28-2" title="2"></a>
<a class="sourceLine" id="cb28-3" title="3"><span class="ex">pdftk</span> 2.02 a Handy Tool for Manipulating PDF Documents</a>
<a class="sourceLine" id="cb28-4" title="4"><span class="ex">Copyright</span> (c) <span class="ex">2003-13</span> Steward and Lee, LLC - Please Visit: www.pdftk.com</a>
<a class="sourceLine" id="cb28-5" title="5"><span class="ex">This</span> is free software<span class="kw">;</span> <span class="ex">see</span> the source code for copying conditions. There is</a>
<a class="sourceLine" id="cb28-6" title="6"><span class="ex">NO</span> warranty, not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</a></code></pre></div>
<p>無事に入ったぞ。よかった。</p>
<p><a href="https://qiita.com/matarillo/items/f036a9561a4839275e5f">WLS2のUbuntuでsystemdを使う</a>。</p>
<p>unshareにより、隔離された名前空間でデーモンとなるので、nsenterでその中に入る。</p>
<h2 id="月08日水"><a href="#08">09月08日(水)</a> <a id="08"></a></h2>
<p>WSL2のUbuntuでpdftkを使いたい。そのためにはsnapが必要。しかし、WSL2のUbuntuではsnapdが走っていない。走らせるには<a href="https://github.com/microsoft/WSL/issues/5126#issuecomment-653715201">以下のようにすれば良いらしい</a>。</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb29-1" title="1"><span class="fu">sudo</span> apt-get update <span class="kw">&amp;&amp;</span> <span class="fu">sudo</span> apt-get install -yqq daemonize dbus-user-session fontconfig</a>
<a class="sourceLine" id="cb29-2" title="2"><span class="fu">sudo</span> daemonize /usr/bin/unshare --fork --pid --mount-proc /lib/systemd/systemd --system-unit=basic.target</a>
<a class="sourceLine" id="cb29-3" title="3"><span class="bu">exec</span> sudo nsenter -t <span class="va">$(</span><span class="fu">pidof</span> systemd<span class="va">)</span> -a su - <span class="va">$LOGNAME</span></a></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb30-1" title="1">$ <span class="ex">snap</span> version</a>
<a class="sourceLine" id="cb30-2" title="2"><span class="ex">snap</span>    2.49.2+20.04</a>
<a class="sourceLine" id="cb30-3" title="3"><span class="ex">snapd</span>   2.49.2+20.04</a>
<a class="sourceLine" id="cb30-4" title="4"><span class="ex">series</span>  16</a>
<a class="sourceLine" id="cb30-5" title="5"><span class="ex">ubuntu</span>  20.04</a>
<a class="sourceLine" id="cb30-6" title="6"><span class="ex">kernel</span>  4.19.128-microsoft-standard</a></code></pre></div>
<p>動いた。</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb31-1" title="1"><span class="fu">sudo</span> snap install pdftk</a></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb32-1" title="1">$ <span class="ex">pdftk</span> --version</a>
<a class="sourceLine" id="cb32-2" title="2"></a>
<a class="sourceLine" id="cb32-3" title="3"><span class="ex">pdftk</span> 2.02 a Handy Tool for Manipulating PDF Documents</a>
<a class="sourceLine" id="cb32-4" title="4"><span class="ex">Copyright</span> (c) <span class="ex">2003-13</span> Steward and Lee, LLC - Please Visit: www.pdftk.com</a>
<a class="sourceLine" id="cb32-5" title="5"><span class="ex">This</span> is free software<span class="kw">;</span> <span class="ex">see</span> the source code for copying conditions. There is</a>
<a class="sourceLine" id="cb32-6" title="6"><span class="ex">NO</span> warranty, not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</a></code></pre></div>
<p>わーい、入った。</p>
<h2 id="月07日火"><a href="#07">09月07日(火)</a> <a id="07"></a></h2>
<p>書類発送した。</p>
<p>忙しい忙しい。</p>
<p>頼まれてた本を買おうとしたら、生協が閉まってた。そうだ、16時までだった……</p>
<h2 id="月06日月"><a href="#06">09月06日(月)</a> <a id="06"></a></h2>
<p>忙しい忙しい。</p>
<p>OS自作もくもく会。8章の途中。むずい。</p>
<h2 id="月05日日"><a href="#05">09月05日(日)</a> <a id="05"></a></h2>
<p>いつのころからかVSCodeがローカルの<code>.markdownlint.json</code>を読まなくなってる？← WSL2のUbuntuにMarkdownlintが入っていなかったのが原因だった。インストールしたら読むようになった。</p>
<p>うーん、ネットですごい自信満々な人をよく見かけるんだけど、なんであんなに自分に自信持てるんだろ。近くにつよつよな人がいなかったのかなぁ。</p>
<p>作業中のBGMにYouTube聞いてるんだけど、一時期出なくなってたHero Warsがまた頻繁に出始めた。広告設定見ると、ちゃんとブロックしていることになっているんだけど。広告主がそれをわかってて、別のタイトルの広告として出しているのかなぁ。</p>
<p>僕は「はてブコメント」は悪だと思ってる。少しブックマークされると、「ホットエントリ(ホッテントリとも)」としてトレンドに乗って、それで大勢の目に触れて、さらにブックマークされることになる。で、技術系の記事が「ホットエントリ」に入ると、必ずといって良いほど、一行マウント系のコメントがつく。よくあるパターンが「なんでこんなのがいまさらホッテントリに？」みたいに、「俺はこんなの前から知ってたぜ」という奴。後、「いろいろ間違っている気が」という「俺は著者よりも詳しいぜ」というにおわせ系。どちらも「自分の能力のアピール」になっており、どちらも「ネットになんら新しい情報を増やしていない」という点で共通しており、さらに記事の著者のやる気をそぐ。</p>
<p>たまに自分の記事がホットエントリに入っているようだが、はてブコメントを見ると気分が悪くなるので<code>etc/hosts</code>に</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode txt"><code class="sourceCode default"><a class="sourceLine" id="cb33-1" title="1">127.0.0.1       b.hatena.ne.jp</a></code></pre></div>
<p>を指定してしまっている。しかし、スマホだと見られてしまうので、たまに見に行ってしまう(そして気分が悪くなる)。この、「見ると気分が悪くなるのがわかっているのに、つい見に行ってしまう」のは、なんらかの報酬機構のせいだと聞いた(予想が当たることで云々とか)。とりあえずスマホでもブロックしてしまうかな。BlockSiteというアプリが良いらしい。</p>
<h2 id="月04日土"><a href="#04">09月04日(土)</a> <a id="04"></a></h2>
<p><a href="https://zenn.dev/kaityo256/articles/objects_of_git">Gitのオブジェクトの中身についての記事</a>書いた。そろそろGitを人に教えてもおこがましくない知識を得られただろうか。</p>
<h2 id="月03日金"><a href="#03">09月03日(金)</a> <a id="03"></a></h2>
<p>いろいろ忙しい。講義の準備がヤバい。</p>
<h2 id="月02日木"><a href="#02">09月02日(木)</a> <a id="02"></a></h2>
<p>Windowsのプリンター関連の「モニタリングツール」というのが入っているのだが、それがアップデートを要求してきた。何の気なしに「更新履歴」を見てみたら「社名変更」だけでずっこけてしまった。</p>
<p>なんかBoxeditというアプリが常駐してて何かと思ったら、Box上のファイルをローカルで開くためのツールらしい。要するにローカルにダウンロードしたファイルを監視し、変更があったら裏でアップロードするツール。うーむ。</p>
<p><a href="https://zenn.dev/wx257osn2/articles/rip_cxx_amp-ksaudhawigubweinfwklaeiuhfawelifh">C++ AMPの死について</a></p>
<p>なんか、Intelの奴も死んでなかったっけ？</p>
<p>思い出した、<a href="https://www.isus.jp/products/c-compilers/goodbye-cilk-plus-01/">Intel Cilk Plus</a>だ。</p>
<p>研究室ミーティング。本読み輪講。一冊終わりそう。素晴らしい。</p>
<p>Gitのハッシュがどうしても合わないと悩んでいたら、Vimが保存時に行末に改行コードを自動的に付与するという仕様のせいだった。しらなかった。</p>
<p>Pro Gitのハッシュ値の計算をする例をPythonで書き直す。</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode py"><code class="sourceCode python"><a class="sourceLine" id="cb34-1" title="1"><span class="im">import</span> hashlib</a>
<a class="sourceLine" id="cb34-2" title="2">content <span class="op">=</span> <span class="st">&quot;what is up, doc?&quot;</span></a>
<a class="sourceLine" id="cb34-3" title="3">store <span class="op">=</span> <span class="ss">f&quot;blob </span><span class="sc">{</span><span class="bu">len</span>(content)<span class="sc">}</span><span class="ch">\0</span><span class="sc">{</span>content<span class="sc">}</span><span class="ss">&quot;</span>.encode(<span class="st">&quot;utf-8&quot;</span>)</a>
<a class="sourceLine" id="cb34-4" title="4"><span class="bu">hash</span> <span class="op">=</span> hashlib.sha1(store).hexdigest()</a>
<a class="sourceLine" id="cb34-5" title="5"><span class="bu">print</span>(<span class="bu">hash</span>) <span class="co">#=&gt; bd9dbf5aae1a3862dd1526723246b20206e5fc37    </span></a></code></pre></div>
<p>できた。続き。</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode py"><code class="sourceCode python"><a class="sourceLine" id="cb35-1" title="1"><span class="im">import</span> zlib</a>
<a class="sourceLine" id="cb35-2" title="2">data <span class="op">=</span> zlib.compress(store)</a>
<a class="sourceLine" id="cb35-3" title="3"><span class="bu">print</span>(<span class="bu">bytes</span>.<span class="bu">hex</span>(data)) <span class="co">#=&gt; 789c4bcac94f5230346328cf482c51c82c56282dd05148c94fb607005f1c079d</span></a></code></pre></div>
<p>こっちもできた。gitの作るオブジェクトと比べる。</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb36-1" title="1"><span class="fu">git</span> init</a>
<a class="sourceLine" id="cb36-2" title="2"><span class="bu">echo</span> -n <span class="st">&quot;what is up, doc?&quot;</span> <span class="op">&gt;</span> test.txt</a>
<a class="sourceLine" id="cb36-3" title="3"><span class="fu">git</span> add test.txt </a></code></pre></div>
<p>この時点で「bd9dbf5aae1a3862dd1526723246b20206e5fc37」というオブジェクトができて、中身が「789c4bcac94f5230346328cf482c51c82c56282dd05148c94fb607005f1c079d」になっているはず。</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb37-1" title="1">$ <span class="fu">od</span> -tx1 .git/objects/bd/9dbf5aae1a3862dd1526723246b20206e5fc37 </a>
<a class="sourceLine" id="cb37-2" title="2"><span class="ex">0000000</span>    78  01  4b  ca  c9  4f  52  30  34  63  28  cf  48  2c  51  c8</a>
<a class="sourceLine" id="cb37-3" title="3"><span class="ex">0000020</span>    2c  56  28  2d  d0  51  48  c9  4f  b6  07  00  5f  1c  07  9d</a>
<a class="sourceLine" id="cb37-4" title="4"><span class="ex">0000040</span></a></code></pre></div>
<p>なってますね。</p>
<p>もう一度、`Hello Git!"でやりなおす。</p>
<p>ハッシュ値が一致することを確認。</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb38-1" title="1">$ <span class="bu">echo</span> -n <span class="st">&#39;Hello Git!&#39;</span> <span class="op">&gt;</span> test.txt</a>
<a class="sourceLine" id="cb38-2" title="2">$ <span class="fu">git</span> hash-object test.txt </a>
<a class="sourceLine" id="cb38-3" title="3"><span class="ex">fdc3d3cd37c23aeb665aa995f395d9c6979bd508</span></a>
<a class="sourceLine" id="cb38-4" title="4"></a>
<a class="sourceLine" id="cb38-5" title="5">$ <span class="kw">{</span> <span class="bu">echo</span> -n <span class="st">&#39;blob 10\0&#39;</span><span class="kw">;</span><span class="fu">cat</span> test.txt<span class="kw">}</span> <span class="kw">|</span> <span class="ex">shasum</span> </a>
<a class="sourceLine" id="cb38-6" title="6"><span class="ex">fdc3d3cd37c23aeb665aa995f395d9c6979bd508</span>  -</a></code></pre></div>
<p>中身が一致することを確認。</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb39-1" title="1">$ <span class="fu">git</span> init</a>
<a class="sourceLine" id="cb39-2" title="2">$ <span class="fu">git</span> add test.txt</a>
<a class="sourceLine" id="cb39-3" title="3">$ <span class="fu">od</span> -tx1 .git/objects/fd/c3d3cd37c23aeb665aa995f395d9c6979bd508</a>
<a class="sourceLine" id="cb39-4" title="4"><span class="ex">0000000</span>    78  01  4b  ca  c9  4f  52  30  34  60  f0  48  cd  c9  c9  57</a>
<a class="sourceLine" id="cb39-5" title="5"><span class="ex">0000020</span>    70  cf  2c  51  04  00  34  98  05  7a                        </a>
<a class="sourceLine" id="cb39-6" title="6"><span class="ex">0000032</span></a></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="sourceCode py"><code class="sourceCode python"><a class="sourceLine" id="cb40-1" title="1"><span class="im">import</span> zlib</a>
<a class="sourceLine" id="cb40-2" title="2">content <span class="op">=</span> <span class="st">&quot;Hello Git!&quot;</span></a>
<a class="sourceLine" id="cb40-3" title="3">store <span class="op">=</span> <span class="ss">f&quot;blob </span><span class="sc">{</span><span class="bu">len</span>(content)<span class="sc">}</span><span class="ch">\0</span><span class="sc">{</span>content<span class="sc">}</span><span class="ss">&quot;</span>.encode(<span class="st">&quot;utf-8&quot;</span>)</a>
<a class="sourceLine" id="cb40-4" title="4">data <span class="op">=</span> zlib.compress(store)</a>
<a class="sourceLine" id="cb40-5" title="5"><span class="bu">print</span>(<span class="bu">bytes</span>.<span class="bu">hex</span>(data))</a></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb41-1" title="1">$ <span class="ex">python3</span> test.py</a>
<a class="sourceLine" id="cb41-2" title="2"><span class="ex">789c4bcac94f52303460f048cdc9c95770cf2c5104003498057a</span></a></code></pre></div>
<p>一致していますね。めでたい。これでGit内部についてはおしまいかな。</p>
<p>Gitのblobは<code>binary large object</code>の略らしい。ほんとか？</p>
<p>少なくとも<a href="https://docs.github.com/en/rest/reference/git#blobs">GitHubはそう言っている</a>と。</p>
<p>Gitのコミットオブジェクトは</p>
<ul>
<li>スナップショット全体を保存するtreeオブジェクト</li>
<li>親コミット</li>
<li>著者やメールアドレス</li>
<li>コミットメッセージ</li>
</ul>
<p>を含んでいる。</p>
<p>スナップショットを保存するtreeオブジェクトは、ワーキングツリーのファイルとディレクトリを保存している。ディレクトリはtree、ファイルはblobオブジェクトとして保存。blobオブジェクトはファイル名を保存しておらず、blobとファイル名を結びつけるのはtree。したがって、同じ内容で異なるファイル名を持つファイルがワーキングツリーにある場合、blobオブジェクトは一つになり、treeオブジェクトが二つのファイルとして認識する。</p>
<p>よし、Gitの内部状態についてはもうだいたい理解したな。</p>
<h2 id="月01日水"><a href="#01">09月01日(水)</a> <a id="01"></a></h2>
<p>9月になってしまった。</p>
<p>科研費の独立基盤形成の書類を一つ提出。これであとひとつのはず。</p>
<p>健康診断の予約したぞ。</p>
<p>久しぶりに迷惑メールみたら、8月16日に友人から久しぶりに来てたメールが迷惑メールに振り分けられているのを発見。Gmailの迷惑メール判定、もう信頼できない(偽陽性が多すぎる)ので、数日に一度は見に行かないとダメだな……</p>
<p>git rebaseの説明をZennに書いた。こうしてトピックごとにZennに書いて、思考を整理してから講義ノートにまとめていくスタイル。</p>
<p>Linuxのコマンドグルーピングというものを知った。echoの結果とcatの結果を、この順番でファイルに落としたい。</p>
<p>普通にやるなら中間ファイルが必要。</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb42-1" title="1"><span class="bu">echo</span> <span class="st">&quot;Hoge&quot;</span> <span class="op">&gt;</span> head.txt</a>
<a class="sourceLine" id="cb42-2" title="2"><span class="fu">cat</span> head.txt tail.txt <span class="op">&gt;</span> total.txt</a></code></pre></div>
<p>しかし、中括弧で囲むとこんなことができる。</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb43-1" title="1">{<span class="ex">echo</span> <span class="st">&quot;Hoge&quot;</span><span class="kw">;</span> <span class="fu">cat</span> tail.txt<span class="kw">;</span>} <span class="op">&gt;</span> <span class="ex">total.txt</span></a></code></pre></div>
<p>これで、Gitのハッシュを調べることができる。こんなファイルを考える。</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode txt"><code class="sourceCode default"><a class="sourceLine" id="cb44-1" title="1">Hello Git!</a></code></pre></div>
<p>Gitのハッシュを調べる。</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb45-1" title="1">$ <span class="fu">git</span> hash-object test.txt</a>
<a class="sourceLine" id="cb45-2" title="2"><span class="ex">106287c47fd25ad9a0874670a0d5c6eacf1bfe4e</span></a></code></pre></div>
<p>Gitのハッシュはsha1sumなのだが、このまま食わせると違うものになる。</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb46-1" title="1">$ <span class="ex">shasum</span> test.txt</a>
<a class="sourceLine" id="cb46-2" title="2"><span class="ex">871fc2d049fbfab104eeca13c37ff938a1ffaf3d</span>  test.txt</a></code></pre></div>
<p>これは、頭に<code>blob filesize\0</code>というヘッダがついているから。filesizeはファイルサイズ。<code>\0</code>はヌル文字。</p>
<p>ファイルサイズを調べる。</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb47-1" title="1">$ <span class="fu">wc</span> -c <span class="op">&lt;</span> test.txt</a>
<a class="sourceLine" id="cb47-2" title="2">      <span class="ex">11</span></a></code></pre></div>
<p>11バイトなので、<code>blob 11\0</code>をヘッダとして追加し、それを<code>shasum</code>にかける。</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb48-1" title="1">$ <span class="kw">{</span> <span class="bu">echo</span> -en <span class="st">&#39;blob 11\0&#39;</span><span class="kw">;</span> <span class="fu">cat</span> test.txt<span class="kw">;</span> <span class="kw">}</span> <span class="kw">|</span> <span class="ex">shasum</span></a>
<a class="sourceLine" id="cb48-2" title="2"><span class="ex">106287c47fd25ad9a0874670a0d5c6eacf1bfe4e</span>  -</a>
<a class="sourceLine" id="cb48-3" title="3"></a>
<a class="sourceLine" id="cb48-4" title="4">$ <span class="fu">git</span> hash-object test.txt</a>
<a class="sourceLine" id="cb48-5" title="5"><span class="ex">106287c47fd25ad9a0874670a0d5c6eacf1bfe4e</span></a></code></pre></div>
<p>よしよし、無事に一致した。</p>
          </article>
  </body>

  </html>