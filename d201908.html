<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="generator" content="pandoc">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
                <title>2019年8月</title>
    <style type="text/css">
      code {
        white-space: pre;
      }
    </style>
        <style type="text/css"></style>

    <link rel="stylesheet" href="style.css" type="text/css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- link rel="stylesheet" href="github-markdown.css" type="text/css" / -->
          </head>

  <body>
    <article class="markdown-body">
                        <h1 id="年8月">2019年8月</h1>
                        <h2 id="月29日木">8月29日(木)</h2>
                        <p>CentOSでgnuplotでunable to open
                        DISPLAY的なこと言われるなぁ、と思ってたら、そもそもX11入ってなかった。</p>
                        <div class="sourceCode" id="cb1"><pre
                        class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> yum <span class="at">-y</span> groupinstall <span class="st">&quot;X Window System&quot;</span></span></code></pre></div>
                        <h2 id="月27日火">8月27日(火)</h2>
                        <p>Macにgem5を入れる。とりあえずclone。</p>
                        <div class="sourceCode" id="cb2"><pre
                        class="sourceCode sh"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone <span class="at">--depth</span> 1 https://gem5.googlesource.com/public/gem5 </span></code></pre></div>
                        <p>ビルドにはsconsが必要なので入れる。</p>
                        <div class="sourceCode" id="cb3"><pre
                        class="sourceCode sh"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">brew</span> install scons</span></code></pre></div>
                        <p>Python2系列じゃないと動かないようだ。</p>
                        <div class="sourceCode" id="cb4"><pre
                        class="sourceCode sh"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pyenv</span> local anaconda2-4.4.0</span></code></pre></div>
                        <div class="sourceCode" id="cb5"><pre
                        class="sourceCode sh"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">scons</span> build/X86/gem5.opt</span></code></pre></div>
                        <p>sconsは、まずbuildを探すが、このディレクトリが存在しないために<code>build_opts</code>を探しに行く。するとそこに<code>X86</code>があるので、それを参照しつつ、<code>build</code>を作って、そこにgem5のバイナリを作る。</p>
                        <p>ビルドできたらか確認する。</p>
                        <div class="sourceCode" id="cb6"><pre
                        class="sourceCode sh"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ./build/X86/gem5.opt <span class="at">--version</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ex">gem5.opt</span> 2.0</span></code></pre></div>
                        <p>できたっぽい。</p>
                        <p>次、テスト。</p>
                        <div class="sourceCode" id="cb7"><pre
                        class="sourceCode sh"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ./build/X86/gem5.opt ./configs/example/se.py <span class="at">-c</span> ./tests/test-progs/hello/bin/x86/linux/hello</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">gem5</span> Simulator System.  http://gem5.org</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="ex">gem5</span> is copyrighted software<span class="kw">;</span> <span class="ex">use</span> the <span class="at">--copyright</span> option for details.</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="ex">gem5</span> compiled Aug 27 2019 12:23:47</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="ex">gem5</span> started Aug 27 2019 12:27:22</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="ex">gem5</span> executing on watanabe-iMac.local, pid 65602</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="bu">command</span> line: ./build/X86/gem5.opt ./configs/example/se.py <span class="at">-c</span> ./tests/test-progs/hello/bin/x86/linux/hello</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="ex">Global</span> frequency set at 1000000000000 ticks per second</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="ex">warn:</span> DRAM device capacity <span class="er">(</span><span class="ex">8192</span> Mbytes<span class="kw">)</span> <span class="ex">does</span> not match the address range assigned <span class="er">(</span><span class="ex">512</span> Mbytes<span class="kw">)</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="ex">0:</span> system.remote_gdb: listening for remote gdb on port 7000</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="ex">****</span> REAL SIMULATION <span class="pp">****</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="ex">info:</span> Entering event queue @ 0.  Starting simulation...</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="ex">Hello</span> world!</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="ex">Exiting</span> @ tick 5984000 because exiting with last active thread context</span></code></pre></div>
                        <p>無事に実行できた。</p>
                        <p>次、Linuxで作ったバイナリを持ってくる。SEではdynamicリンクができないので、-staticをつける必要がある。</p>
                        <div class="sourceCode" id="cb8"><pre
                        class="sourceCode sh"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> gcc test.c <span class="at">-static</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="ex">/usr/bin/ld:</span> <span class="at">-lc</span> が見つかりません</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="ex">collect2:</span> エラー: ld はステータス 1 で終了しました</span></code></pre></div>
                        <p>glibcのstaticリンク用ライブラリが必要。</p>
                        <div class="sourceCode" id="cb9"><pre
                        class="sourceCode sh"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> yum install glibc-static</span></code></pre></div>
                        <div class="sourceCode" id="cb10"><pre
                        class="sourceCode sh"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> test.c <span class="at">-static</span></span></code></pre></div>
                        <p>問題なくコンパイルできた。</p>
                        <div class="sourceCode" id="cb11"><pre
                        class="sourceCode sh"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./build/X86/gem5.opt</span> ./configs/example/se.py <span class="at">-c</span> a.out</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="ex">gem5</span> Simulator System.  http://gem5.org</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="ex">gem5</span> is copyrighted software<span class="kw">;</span> <span class="ex">use</span> the <span class="at">--copyright</span> option for details.</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="ex">gem5</span> compiled Aug 27 2019 12:23:47</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="ex">gem5</span> started Aug 27 2019 12:35:48</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="ex">gem5</span> executing on watanabe-iMac.local, pid 65827</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="bu">command</span> line: ./build/X86/gem5.opt ./configs/example/se.py <span class="at">-c</span> a.out</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="ex">Global</span> frequency set at 1000000000000 ticks per second</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="ex">warn:</span> DRAM device capacity <span class="er">(</span><span class="ex">8192</span> Mbytes<span class="kw">)</span> <span class="ex">does</span> not match the address range assigned <span class="er">(</span><span class="ex">512</span> Mbytes<span class="kw">)</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="ex">0:</span> system.remote_gdb: listening for remote gdb on port 7000</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="ex">****</span> REAL SIMULATION <span class="pp">****</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="ex">info:</span> Entering event queue @ 0.  Starting simulation...</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="ex">My</span> first md5</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="ex">Exiting</span> @ tick 6651000 because exiting with last active thread context</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="ex">Simulated</span> exit code not 0! Exit code is 13</span></code></pre></div>
                        <p>実行できたぞ。最後にExit
                        codeについて文句言ってるけど、ちゃんとmain関数の最後で<code>return 0;</code>すれば良い。</p>
                        <div class="sourceCode" id="cb12"><pre
                        class="sourceCode sh"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./build/X86/gem5.opt</span> <span class="at">--debug-flags</span><span class="op">=</span>O3PipeView <span class="at">--debug-file</span><span class="op">=</span>trace.out configs/example/se.py <span class="at">--cpu-type</span><span class="op">=</span>DerivO3CPU <span class="at">--caches</span> <span class="at">-c</span> ./a.out</span></code></pre></div>
                        <p>ただprintfするだけでも7.8
                        MBのtrace.outが出力される。</p>
                        <div class="sourceCode" id="cb13"><pre
                        class="sourceCode sh"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./util/o3-pipeview.py</span> <span class="at">-o</span> pipeview.out <span class="at">--color</span> m5out/trace.out</span></code></pre></div>
                        <p>3万2千行(7.5MB)のpipeview.outが出力される。最後に<code>less -r pipeview.out</code>すれば見える。</p>
                        <h2 id="月21日水">8月21日(水)</h2>
                        <p>さくらのサーバ、Dockerを最新版にした。</p>
                        <p><a
                        href="https://docs.docker.com/install/linux/docker-ce/centos/">ここ</a>に記述に従って、以下を順番に実行しただけ。</p>
                        <div class="sourceCode" id="cb14"><pre
                        class="sourceCode sh"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo yum remove docker <span class="dt">\</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                  docker-client <span class="dt">\</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                  docker-client-latest <span class="dt">\</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                  docker-common <span class="dt">\</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>                  docker-latest <span class="dt">\</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>                  docker-latest-logrotate <span class="dt">\</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>                  docker-logrotate <span class="dt">\</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>                  docker-engine</span></code></pre></div>
                        <div class="sourceCode" id="cb15"><pre
                        class="sourceCode sh"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> yum install <span class="at">-y</span> yum-utils <span class="dt">\</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  device-mapper-persistent-data <span class="dt">\</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  lvm2</span></code></pre></div>
                        <div class="sourceCode" id="cb16"><pre
                        class="sourceCode sh"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> yum-config-manager <span class="dt">\</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">--add-repo</span> <span class="dt">\</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    https://download.docker.com/linux/centos/docker-ce.repo</span></code></pre></div>
                        <div class="sourceCode" id="cb17"><pre
                        class="sourceCode sh"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo yum install docker-ce docker-ce-cli containerd.io</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo systemctl start docker</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker <span class="at">--version</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Docker</span> version 19.03.1, build 74b1e89</span></code></pre></div>
                        <p>DockerのCommunity Edition
                        (Docker-CE)が入った。</p>
                        <p>本当はDocker環境でLLVMいれていろいろためそうと思ったんだけど、やっぱり面倒になったのでそのままclangいれた。</p>
                        <div class="sourceCode" id="cb18"><pre
                        class="sourceCode sh"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> yum <span class="at">-y</span> install clang</span></code></pre></div>
                        <h2 id="月20日火">8月20日(火)</h2>
                        <p>Macのsedが使いづらいので、/usr/local/binにあるgsedを、同じディレクトリでsedというシンボリックリンクを貼り、/usr/local/binを/usr/binより先に見に行くようにすることで、gsedを参照するようにした。</p>
          </article>
  </body>

  </html>