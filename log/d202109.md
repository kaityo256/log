# ログ

[ログ一覧](index.html)

## [09月03日(金)](#03) <a id="03"></a>

いろいろ忙しい。講義の準備がヤバい。

## [09月02日(木)](#02) <a id="02"></a>

Windowsのプリンター関連の「モニタリングツール」というのが入っているのだが、それがアップデートを要求してきた。何の気なしに「更新履歴」を見てみたら「社名変更」だけでずっこけてしまった。

なんかBoxeditというアプリが常駐してて何かと思ったら、Box上のファイルをローカルで開くためのツールらしい。要するにローカルにダウンロードしたファイルを監視し、変更があったら裏でアップロードするツール。うーむ。

[C++ AMPの死について](https://zenn.dev/wx257osn2/articles/rip_cxx_amp-ksaudhawigubweinfwklaeiuhfawelifh)

なんか、Intelの奴も死んでなかったっけ？

思い出した、[Intel Cilk Plus](https://www.isus.jp/products/c-compilers/goodbye-cilk-plus-01/)だ。

研究室ミーティング。本読み輪講。一冊終わりそう。素晴らしい。

Gitのハッシュがどうしても合わないと悩んでいたら、Vimが保存時に行末に改行コードを自動的に付与するという仕様のせいだった。しらなかった。

Pro Gitのハッシュ値の計算をする例をPythonで書き直す。

```py
import hashlib
content = "what is up, doc?"
store = f"blob {len(content)}\0{content}".encode("utf-8")
hash = hashlib.sha1(store).hexdigest()
print(hash) #=> bd9dbf5aae1a3862dd1526723246b20206e5fc37    
```

できた。続き。

```py
import zlib
data = zlib.compress(store)
print(bytes.hex(data)) #=> 789c4bcac94f5230346328cf482c51c82c56282dd05148c94fb607005f1c079d
```

こっちもできた。gitの作るオブジェクトと比べる。

```sh
git init
echo -n "what is up, doc?" > test.txt
git add test.txt 
```

この時点で「bd9dbf5aae1a3862dd1526723246b20206e5fc37」というオブジェクトができて、中身が「789c4bcac94f5230346328cf482c51c82c56282dd05148c94fb607005f1c079d」になっているはず。

```sh
$ od -tx1 .git/objects/bd/9dbf5aae1a3862dd1526723246b20206e5fc37 
0000000    78  01  4b  ca  c9  4f  52  30  34  63  28  cf  48  2c  51  c8
0000020    2c  56  28  2d  d0  51  48  c9  4f  b6  07  00  5f  1c  07  9d
0000040
```

なってますね。

もう一度、`Hello Git!"でやりなおす。

ハッシュ値が一致することを確認。

```sh
$ echo -n 'Hello Git!' > test.txt
$ git hash-object test.txt 
fdc3d3cd37c23aeb665aa995f395d9c6979bd508

$ { echo -n 'blob 10\0';cat test.txt} | shasum 
fdc3d3cd37c23aeb665aa995f395d9c6979bd508  -
```

中身が一致することを確認。

```sh
$ git init
$ git add test.txt
$ od -tx1 .git/objects/fd/c3d3cd37c23aeb665aa995f395d9c6979bd508
0000000    78  01  4b  ca  c9  4f  52  30  34  60  f0  48  cd  c9  c9  57
0000020    70  cf  2c  51  04  00  34  98  05  7a                        
0000032
```

```py
import zlib
content = "Hello Git!"
store = f"blob {len(content)}\0{content}".encode("utf-8")
data = zlib.compress(store)
print(bytes.hex(data))
```

```sh
$ python3 test.py
789c4bcac94f52303460f048cdc9c95770cf2c5104003498057a
```

一致していますね。めでたい。これでGit内部についてはおしまいかな。

Gitのblobは`binary large object`の略らしい。ほんとか？

少なくとも[GitHubはそう言っている](https://docs.github.com/en/rest/reference/git#blobs)と。

Gitのコミットオブジェクトは

* スナップショット全体を保存するtreeオブジェクト
* 親コミット
* 著者やメールアドレス
* コミットメッセージ

を含んでいる。

スナップショットを保存するtreeオブジェクトは、ワーキングツリーのファイルとディレクトリを保存している。ディレクトリはtree、ファイルはblobオブジェクトとして保存。blobオブジェクトはファイル名を保存しておらず、blobとファイル名を結びつけるのはtree。したがって、同じ内容で異なるファイル名を持つファイルがワーキングツリーにある場合、blobオブジェクトは一つになり、treeオブジェクトが二つのファイルとして認識する。

よし、Gitの内部状態についてはもうだいたい理解したな。

## [09月01日(水)](#01) <a id="01"></a>

9月になってしまった。

科研費の独立基盤形成の書類を一つ提出。これであとひとつのはず。

健康診断の予約したぞ。

久しぶりに迷惑メールみたら、8月16日に友人から久しぶりに来てたメールが迷惑メールに振り分けられているのを発見。Gmailの迷惑メール判定、もう信頼できない(偽陽性が多すぎる)ので、数日に一度は見に行かないとダメだな……

git rebaseの説明をZennに書いた。こうしてトピックごとにZennに書いて、思考を整理してから講義ノートにまとめていくスタイル。

Linuxのコマンドグルーピングというものを知った。echoの結果とcatの結果を、この順番でファイルに落としたい。

普通にやるなら中間ファイルが必要。

```sh
echo "Hoge" > head.txt
cat head.txt tail.txt > total.txt
```

しかし、中括弧で囲むとこんなことができる。

```sh
{echo "Hoge"; cat tail.txt;} > total.txt
```

これで、Gitのハッシュを調べることができる。こんなファイルを考える。

```txt
Hello Git!
```

Gitのハッシュを調べる。

```sh
$ git hash-object test.txt
106287c47fd25ad9a0874670a0d5c6eacf1bfe4e
```

Gitのハッシュはsha1sumなのだが、このまま食わせると違うものになる。

```sh
$ shasum test.txt
871fc2d049fbfab104eeca13c37ff938a1ffaf3d  test.txt
```

これは、頭に`blob filesize\0`というヘッダがついているから。filesizeはファイルサイズ。`\0`はヌル文字。

ファイルサイズを調べる。

```sh
$ wc -c < test.txt
      11
```

11バイトなので、`blob 11\0`をヘッダとして追加し、それを`shasum`にかける。

```sh
$ { echo -en 'blob 11\0'; cat test.txt; } | shasum
106287c47fd25ad9a0874670a0d5c6eacf1bfe4e  -

$ git hash-object test.txt
106287c47fd25ad9a0874670a0d5c6eacf1bfe4e
```

よしよし、無事に一致した。
