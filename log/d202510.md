# 2025年10月

## [10月13日(月)](#13) <a id="13"></a>

リモート作業中にうっかり、

```sh
sudo nmcli con down eno1
sudo nmcli con up eno1
```

をやってしまって接続が切れたノード、物理ログインしてリブートしたら固定IPだけになった。そして、ypbindが走ってるので/homeでpermission denied。まず固定IPを指定してリブート、が最初の作業だな。

まずはNFSのマウント確認。

```sh
$ sudo mount -t nfs 192.168.1.20:/home /mnt/home_nfs
Created symlink /run/systemd/system/remote-fs.target.wants/rpc-statd.service → /usr/lib/systemd/system/rpc-statd.service.
```

この状態で、

```sh
$ cd
-bash: cd: /home/watanabe: 許可がありません
$ cd /mnt/home_nfs/watanabe/
$ 
```

NISでアカウント共有しているので、/homeはpermission deniedだが、/mnt/home_nfs/watanabe/はちゃんと見れる。正しくNIS共有+NFSできてますね。よしよし。

```sh
sudo umount /mnt/home_nfs/
sudo mount -t nfs 192.168.1.20:/home /home
cd
```

/home通った。dfで確認。

```sh
$ df | grep home
192.168.1.20:/home  46872928256 27035027456 19837900800   58% /home
```

よしよし。`/etc/fstab`を以下のように修正。

```sh
/dev/mapper/rl-root     /                       xfs     defaults        0 0
UUID=1a0defb8-f376-4254-8e56-3a9a9cbe949f /boot                   xfs     defaults        0 0
UUID=DD5A-1F2D          /boot/efi               vfat    umask=0077,shortname=winnt 0 2
#/dev/mapper/rl-home     /home                   xfs     defaults        0 0
/dev/mapper/rl-swap     none                    swap    defaults        0 0
192.168.1.20:/home      /home                   nfs     defaults,_netdev  0  0
```

リブート。ここまでで、

* ホストベース認証
* NIS共有
* NFS

まで通った。

次、slurmのインストール(クライアント)。

`/etc/selinux/config`で

```sh
SELINUX=disabled
```

にしてからreboot。

mungeのインストール

```sh
sudo dnf -y install munge
```

リブートしたら外に繋がらんくなった。なんでだよ・・・

yagami02のdefault gatewayが192.168.1.2なのに、yagami03が192.168.1.1になってた。コマンド履歴を見ると192.168.1.2を指定しているんだけどなぁ。

```sh
sudo ip route del default
sudo ip route add default via 192.168.1.2 dev eno1
```

により通ったので、

```sh
sudo nmcli con mod eno1 ipv4.gateway "192.168.1.2"
sudo nmcli con up eno1
```

で永続化。

あと、nameserverはNetworkManagerが自動生成するので、/etc/resolv.confを手で書いても上書きされてしまう。

```sh
sudo nmcli con mod eno1 ipv4.dns "1.1.1.1"
sudo systemctl restart NetworkManager
```

これで/etc/resolv.confが修正されていることを確認。

改めてmungeのインストール。

ログインノードから計算ノードにmunge.keyのコピーをする必要があるが、/homeを共有しているのでそこを経由して。

```sh
sudo cp /etc/munge/munge.key .
sudo cp munge.key /etc/munge/
sudo chown munge:munge /etc/munge/munge.key
```

追記：chownを忘れてた

```sh
sudo dnf install slurm slurm-slurmd munge
```

slurm.confにyagami03を追加。

ログインノードのslurm.confを/home経由でコピー。

```sh
sudo cp slurm.conf /etc/slurm/
```

計算ノードは6818をあける必要がある。

```sh
sudo firewall-cmd --permanent --add-port=6818/tcp
sudo systemctl restart firewalld
```

追記：firewallの再起動を忘れて、つながらなかった。

ディレクトリの作成と所有者の修正。

```sh
sudo mkdir -p /var/spool/slurm/d /var/log/slurm /var/run/slurm
sudo chown -R slurm:slurm /var/spool/slurm /var/log/slurm /var/run/slurm
sudo chmod 755 /var/spool/slurm /var/log/slurm /var/run/slurm
```

mungeとslurmdを起動。自動起動も追加。

```sh
sudo systemctl start munge
sudo systemctl start slurmd
sudo systemctl enable --now munge
sudo systemctl enable --now slurmd
```

ログインノードで、slurmdctldの再起動。

```sh
sudo systemctl restart slurmctld
sudo scontrol reconfigure
```

sinfoで確認。OK。

その後yagami03を再起動したらまた死んだ。

```sh
sudo systemctl enable --now munge
sudo systemctl enable --now slurmd
```

を設定して自動起動をONにしていなかったのが原因。起動してからログインノードで以下を実行したら復活。

```sh
sudo scontrol update nodename=yagami03.appi.keio.ac.jp state=resume
```

## [10月12日(日)](#12) <a id="12"></a>

子どものスマホを契約。契約にすげー時間がかかった上、その後の設定にもすげー時間がかかって消耗・・・

疲れて今日はレポートの採点ができなかった・・・

## [10月11日(土)](#11) <a id="11"></a>

会議とか。

プログラミング基礎同演習のレポート採点。すげー時間かかったな。

## [10月10日(金)](#10) <a id="10"></a>

故障したサーバにRockeyを入れ直す。別の計算ノードでバージョン確認。

```sh
$ cat /etc/redhat-release 
Rocky Linux release 9.6 (Blue Onyx)
```

9.6ですね。

MacのターミナルからRockey Linux release 9.6のブータブルUSBを作ろうとしたが、ddを使ったりして危ないな。
ChatGPTにBalena Etcherというのを紹介されたが、ここは大人しくWindowsでRufasを使うか。

[https://rufus.ie/ja/](https://rufus.ie/ja/)からRufasをダウンロード。

[Rocky-9.6-x86_64-dvd.iso](https://download.rockylinux.org/pub/rocky/9/isos/x86_64/Rocky-9.6-x86_64-dvd.iso)をダウンロード、しようとしたが、公式サイトからは重すぎる。

[理研のミラー](https://ftp.riken.jp/Linux/rocky/9.6/isos/x86_64/)からダウンロード。

作業ログ。

* USBブートして計算ノードにRockeyを再インストール。
* rootパスワード指定
* インストール終了後再起動。USBを抜く。
* 起動後、最初に自分のユーザアカウントを追加
* 自分をsudoersに追加
* ホスト名の設定

  ```sh
  $ hostnamectl
    Static hostname: (unset)                           
  Transient hostname: localhost
          Icon name: computer-server
            Chassis: server 🖳
          Machine ID: 203813d2d4d548c5a2fa0799e8e79eaf
            Boot ID: ff05f843ffa64940916e346d133e6e97
    Operating System: Rocky Linux 9.6 (Blue Onyx)       
        CPE OS Name: cpe:/o:rocky:rocky:9::baseos
              Kernel: Linux 5.14.0-570.17.1.el9_6.x86_64
        Architecture: x86-64
    Hardware Vendor: Dell Inc.
      Hardware Model: PowerEdge R640
    Firmware Version: 2.8.1

  $ sudo hostnamectl set-hostname yagami03

  $ hostnamectl
  Static hostname: yagami03
        Icon name: computer-server
          Chassis: server 🖳
        Machine ID: 203813d2d4d548c5a2fa0799e8e79eaf
          Boot ID: ff05f843ffa64940916e346d133e6e97
  Operating System: Rocky Linux 9.6 (Blue Onyx)       
      CPE OS Name: cpe:/o:rocky:rocky:9::baseos
            Kernel: Linux 5.14.0-570.17.1.el9_6.x86_64
      Architecture: x86-64
  Hardware Vendor: Dell Inc.
    Hardware Model: PowerEdge R640
  Firmware Version: 2.8.1
  ```

  `hostnamectl`で現状確認、`hostnamectl set-hostname`で名前設定。
* ネットワークを固定IPに。
    * `nmcli connection show`で現状確認。

    ```sh
    $ nmcli connection show
    NAME  UUID                                  TYPE      DEVICE 
    eno1  97a43ef0-4f9d-39ba-b999-8213ca8b2f38  ethernet  eno1   
    lo    9e831b82-81ee-4317-b89e-1faf308b3e3b  loopback  lo     
    eno2  ae6e89b9-e5aa-462e-b45f-dcf149d13056  ethernet  --     
    eno3  46292068-2837-4836-916d-9b4477bf5b68  ethernet  --     
    eno4  fc161a70-08b3-4f82-ab17-d2f854f084b6  ethernet  -- 
    ```

    * DEVICEに出てきたのでeno1で接続していることがわかる。
    * eno1に192.168.1.13を設定(192.168.1.12を参考に)

    ```sh
    sudo nmcli connection modify eno1 ipv4.addresses 192.168.1.13/24
    sudo nmcli connection modify eno1 ipv4.gateway 192.168.1.2
    sudo nmcli connection modify eno1 ipv4.dns "1.1.1.1"
    sudo nmcli connection modify eno1 ipv4.method manual
    sudo nmcli connection modify eno1 ipv6.method ignore
    ```

    * ネットワーク再起動

    ```sh
    sudo systemctl restart NetworkManager
    ```

    * 別窓から新しいIPで接続して成功したことを確認。
* NISのインストールをソースから
    * Gitのインストール

    ```sh
    sudo dnf update -y
    sudo dnf install -y git
    ```

    * [ここ](https://web.chaperone.jp/w/index.php?NIS/rockylinux9)の通りに実行

    ```sh
    mkdir build
    cd build
    git clone https://github.com/thkukuk/ypbind-mt
    cd ypbind-mt
    git checkout v2.7.2
    cd ..
    tar --exclude-vcs --transform 's/ypbind-mt/ypbind-mt-2.7.2/' -cvzf ypbind-mt-2.7.2.tar.gz ypbind-mt
    ```

    これで`ypbind-mt-2.7.2.tar.gz`が作られる。
    * ypbindの作成

    ```sh
    curl -O http://dl.rockylinux.org/pub/rocky/8/AppStream/source/tree/Packages/y/ypbind-2.5-2.el8.src.rpm
    rpm -Uvh ypbind-2.5-2.el8.src.rpm
    vi ~/rpmbuild/SPECS/ypbind.spec # ブログ記事を参考に修正
    ```

    ```sh
    dnf --enablerepo=devel install -y dbus-glib-devel libnsl2-devel libtirpc-devel systemd-devel
    cd build
    cp ypbind-mt-2.7.2.tar.gz ~/rpmbuild/SOURCES/
    sudo dnf install -y rpm-build
    sudo dnf install -y autoconf automake gettext-devel docbook-style-xsl
    sudo dnf groupinstall -y "Development Tools"
    rpmbuild -bb ~/rpmbuild/SPECS/ypbind.spec
    ``` 

    * nss_nis

    ```sh
    cd
    cd build
    git clone https://github.com/thkukuk/libnss_nis
    cd libnss_nis
    git checkout v3.2
    cd ..
    tar --exclude-vcs --transform 's/libnss_nis/libnss_nis-3.2/' -cvzf libnss_nis-3.2.tar.gz libnss_nis
    ```

    ibnss_nis-3.2.tar.gzができる。
    * rpm作成

    ```sh
    curl -O http://dl.rockylinux.org/pub/rocky/8/BaseOS/source/tree/Packages/n/nss_nis-3.0-8.el8.src.rpm
    rpm -Uvh nss_nis-3.0-8.el8.src.rpm
    vi ~/rpmbuild/SPECS/nss_nis.spec  # ブログ記事を参考に修正
    cp libnss_nis-3.2.tar.gz ~/rpmbuild/SOURCES/
    rpmbuild -bb ~/rpmbuild/SPECS/nss_nis.spec
    ```

    できたかどうか確認。

    ```sh
    $ ls ~/rpmbuild/RPMS/x86_64/nss_nis-*
    /home/watanabe/rpmbuild/RPMS/x86_64/nss_nis-3.2-8.el9.x86_64.rpm
    /home/watanabe/rpmbuild/RPMS/x86_64/nss_nis-debuginfo-3.2-8.el9.x86_64.rpm
    /home/watanabe/rpmbuild/RPMS/x86_64/nss_nis-debugsource-3.2-8.el9.x86_64.rpm
    ```

    * yp-tools

    ```sh
    cd
    cd build
    curl -O http://dl.rockylinux.org/pub/rocky/8/AppStream/source/tree/Packages/y/yp-tools-4.2.3-2.el8.src.rpm
    rpmbuild --rebuild yp-tools-4.2.3-2.el8.src.rpm
    ```

    できたかどうか確認

    ```sh
    $ ls ~/rpmbuild/RPMS/x86_64/yp-tools-*
    /home/watanabe/rpmbuild/RPMS/x86_64/yp-tools-4.2.3-2.el9.x86_64.rpm
    /home/watanabe/rpmbuild/RPMS/x86_64/yp-tools-debuginfo-4.2.3-2.el9.x86_64.rpm
    /home/watanabe/rpmbuild/RPMS/x86_64/yp-tools-debugsource-4.2.3-2.el9.x86_64.rpm
    ```

    * できたRPMのインストール。

    ```sh
    sudo dnf localinstall -y ~/rpmbuild/RPMS/x86_64/ypbind-2.7.2-2.el9.x86_64.rpm ~/rpmbuild/RPMS/x86_64/nss_nis-3.2-8.el9.x86_64.rpm ~/rpmbuild/RPMS/x86_64/yp-tools-4.2.3-2.el9.x86_64.rpm
    ```

    * /etc/yum.confに以下を追加。

    ```txt
    exclude=ypbind nss_nis yp-tools authselect-libs autofs
    ```

    * ypbind起動。

    ```sh
    sudo systemctl enable ypbind --now
    ```

    失敗。
    * `rpcinfo -p NISサーバ名` が通らない。/etc/hostsをyagami02と同じものに書き換えたら、通った。
    * ypdomainnameをwatanabe-groupに

    ```sh
    sudo ypdomainname watanabe-group
    ```

    * /etc/yp.confを以下のように修正。

    ```sh
    domain watanabe-group server watanabe-login
    ```

    * 動作確認

    ```sh
    sudo systemctl start ypbind
    ypwhich
    ```

    ypwhichまでは通るがgetnetできない。
    * `/etc/nsswitch.conf`をNISを先に見るように直接編集(あまりよくないが)

  ```sh
    passwd:     nis files sss systemd
    group:      nis files [SUCCESS=merge] sss [SUCCESS=merge] systemd
    shadow:     nis files
  ```

  getentが通ることを確認。
* ホストベース認証
    * サーバ側で

    ```sh
    ssh-keyscan -t ed25519 yagami03 | sudo tee -a /etc/ssh/ssh_known_hosts
    ```

    * クライアント側で

    ```sh
    ssh-keyscan -t ed25519 watanabe-login.appi.keio.ac.jp | sudo tee -a /etc/ssh/ssh_known_hosts
    ``` 

    /etc/ssh/sshd_configで

    ```txt
    HostKey /etc/ssh/ssh_host_ed25519_key
    IgnoreUserKnownHosts no
    HostbasedAuthentication yes
    UseDNS yes
    ```

    にする。
    その上で、`/etc/ssh/shosts.equiv`にホストベース認証したいホストをずらずら書く(今回これを忘れていた)。

    ホスト側(計算ノード)で

    ```sh
    sudo firewall-cmd --add-port=2222/tcp
    sudo /usr/sbin/sshd -d -p 2222
    ```

    クライアント側(ログインノード)で

    ```sh
    ssh -o PreferredAuthentications=hostbased yagami03
    ```

    を実行し、通ればOK。sshdをrestart。

疲れたなぁ。

yagai03にNFSのインストール。

```sh
sudo dnf install -y nfs-utils
cd /mnt
sudo mkdir home_nfs
```

失敗する。firewall?

```sh
sudo firewall-cmd --permanent --add-service=nfs
sudo firewall-cmd --permanent --add-service=rpc-bind
sudo firewall-cmd --permanent --add-service=mountd
sudo firewall-cmd --reload
```

ChatGPTの言う通りに作業してて、

```sh
sudo nmcli con down eno1
sudo nmcli con up eno1
```

を叩いてしまい、ネットワーク接続が切れてリモートから作業ができなくなってしまった。アホすぎる。

## [10月09日(木)](#09) <a id="09"></a>

サーバ設定。Rockeyで

```sh
sudo dnf update -y
```

とすると

```txt
Error: 
 Problem 1: package authselect-1.2.6-3.el9.x86_64 from baseos requires authselect-libs(x86-64) = 1.2.6-3.el9, but none of the providers can be installed
  - cannot install the best update candidate for package authselect-1.2.6-2.el9.x86_64
  - package authselect-libs-1.2.6-3.el9.x86_64 from baseos is filtered out by exclude filtering
 Problem 2: package authselect-compat-1.2.6-3.el9.x86_64 from appstream requires authselect(x86-64) = 1.2.6-3.el9, but none of the providers can be installed
  - package authselect-1.2.6-3.el9.x86_64 from baseos requires authselect-libs(x86-64) = 1.2.6-3.el9, but none of the providers can be installed
  - cannot install the best update candidate for package authselect-compat-1.2.6-2.el9.x86_64
  - package authselect-libs-1.2.6-3.el9.x86_64 from baseos is filtered out by exclude filtering
(try to add '--skip-broken' to skip uninstallable packages or '--nobest' to use not only best candidate packages)
```

のようなエラーがでる。これは、`/etc/dnf/dnf.conf`に

```txt
exclude=ypbind nss_nis yp-tools authselect-libs autofs
```

と、authselect-libの除外設定があるから。

Rockeyにslurmインストール。最初にソースからインストールしてしまったので話がややこしくなった。素直にdnfを使うべき。

ログインノードでのジョブ投入は成功。計算ノードからつながらない。

```sh
$ nc -zv login-node-name 6817
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: No route to host.
```

ポートが塞がってますね。ログインノードで以下を実行。

```sh
sudo firewall-cmd --zone=public --add-port=6817/tcp --permanent
sudo firewall-cmd --zone=public --add-port=6818/tcp --permanent
sudo firewall-cmd --reload
```

計算ノードは6818をあける必要がある。

```sh
sudo firewall-cmd --permanent --add-port=6818/tcp
sudo systemctl restart firewalld
```

通った(firewalldを再起動忘れて繋がらなかった・・・)。

次はMPI。計算ノードで以下を実行。

```sh
sudo dnf install -y openmpi openmpi-devel
```

パスを通す。/etc/bashrcに以下を追加。

```sh
export PATH=/usr/lib64/openmpi/bin:$PATH
```

```sh
PartitionName=default Nodes=ALL Default=YES MaxTime=INFINITE State=UP
```

としたらエラー。defaultは予約後だそうで。

```sh
PartitionName=main Nodes=ALL Default=YES MaxTime=INFINITE State=UP
```

としたら通った。

```sh
PartitionName=main Nodes=ALL Default=YES MaxTime=1-00:00:00 State=UP
```

と、24時間制限をつけた。

クラスタにlammpsインストール

```sh
cd github
git clone -b release --depth 1  https://github.com/lammps/lammps.git
cd lammps
mkdir build
cd build
cmake ../cmake \
  -D CMAKE_C_COMPILER=mpicc \
  -D CMAKE_CXX_COMPILER=mpicxx \
  -D CMAKE_INSTALL_PREFIX=~/usr/local \
  -D CMAKE_CXX_FLAGS="-O3 -std=c++11 -fopenmp" \
  -D BUILD_MPI=yes \
  -D BUILD_OMP=yes \
  -D CMAKE_EXE_LINKER_FLAGS="-O3 -std=c++11 -fopenmp" \
  -D PKG_MOLECULE=on
make -j 4
make install
```

無事にログインノード、計算ノードでlammpsも並列に走った。よし。これで研究室クラスター復活。

・・・疲れたなぁ。

## [10月08日(水)](#08) <a id="08"></a>

会議。

来年度に向けて、博士号取得のスケジュール確認をするなどした。

[デロイトがオーストラリア連邦政府から受託した報告書をAIを使って書いたのがバレて返金](https://www.theguardian.com/australia-news/2025/oct/06/deloitte-to-pay-money-back-to-albanese-government-after-using-ai-in-440000-report)

存在しない参考文献でバレたとのこと。デロイトは「報告内容には変更はない」と言っているけれど、「主要な部分もAIで書いたのでは？」と思われるよね・・・

研究室ミーティング。シアシックニングと格闘ゲームの強化学習。今日から本格的に英語での発表です。

NIS共有の設定続き。うまくNIS共有できなかったのはサーバ側のポートが閉じていたから。

サーバ側で

```sh
sudo firewall-cmd --permanent --add-port=861/tcp
sudo firewall-cmd --permanent --add-port=861/udp
sudo firewall-cmd --permanent --add-port=111/tcp
sudo firewall-cmd --permanent --add-port=111/udp
sudo firewall-cmd --reload
```

を実行することでポートが通った。

クライアント側で

```sh
sudo /usr/sbin/ypbind -d
```

を実行することでどこでこけているかがわかる。ypwhichやgetentが通るようになった時点で

```sh
sudo systemctl start ypbind
```

で通った。

クライアントでypbindが自動起動するか確認。

```sh
$ sudo systemctl is-enabled ypbind
enabled
```

大丈夫ですね。

Slurmのインストール途中で時間切れ。

ノーベル化学賞が日本人受賞でバタバタ・・・

## [10月07日(火)](#07) <a id="07"></a>

田園都市線、昨日の深夜に復旧。今日は普通につかえてよかった。

夜は物理学会のノーベル賞対応でバタバタ。

## [10月06日(月)](#06) <a id="06"></a>

昨夜、田園都市線が脱線事故を起こし、最寄り駅が全く動かなくなってしまった。
しばらくしたら復活するかと思ったが、全く復活しなかったので、息子は別の経路で登校。僕は在宅勤務に。

ちょっと接触しただけらしいので、すぐ復旧すると思っていたが、まさか今日一日ずっと不通だとは思わなかった。

息子が帰れないので、車で学校まで迎えにいった。

計算科学春の学校の飛行機とかホテルとかの予約した。こういうの疲れるな。

## [10月05日(日)](#05) <a id="05"></a>

NOP

NOPといいつつ、なんか毎週土日に車での子供の送り迎えがあるから相当疲れる・・・

## [10月04日(土)](#04) <a id="04"></a>

NOP

## [10月03日(金)](#03) <a id="03"></a>

1on1とか。

GitHub演習のガイダンスの準備でバタバタした。アナウンスには正しいURLを書いたが、モジュールのページのZoomのURLが古いままだった。
来年は気をつけないと。

ガイダンスに引き続き、今年から生成AIとの付き合い方のガイダンスも追加。

[生成AIとの付き合い方](https://speakerdeck.com/kaityo256/generative-ai-and-us)

出張申請がボロボロだった。事務の方にいろいろご迷惑をおかけした。大変申し訳ありません。後で修正されたバージョンを確認して、来年から気をつけます。

査読返した。

研究室のジョブスケジューラ確認。Rocky+OpenPBSではトラブルが多いらしい。Slurmだとすぐ入るっぽい。試さないと(いつ？)。

## [10月02日(木)](#02) <a id="02"></a>

講義動画が全てBoxだったのを、K-LMSのVideoにすべて修正した。相当時間かかった。

あと、プログラミング基礎同演習の動画内の回数が間違っているな。確か、コロナの時に講義回数が一回減って、その後追加したからズレたんだな。

講義のガイダンス用の「生成AIとの付き合い方」のスライド最終調整。完成したことにする。GitHub演習とプログラミング基礎同演習で使う予定。

山本さんが[日本生物物理学会学生発表賞を受賞](https://www.biophys.jp/ann/ann01_15.html)。おめでとうございます！

研究室ミーティング。やっぱり英語でやるの結構大変だな。

出版社からの問い合わせを返した。

## [10月01日(水)](#01) <a id="01"></a>

10月になってしまった。毎月これ書いてない？

GitHub演習の班分け表忘れてた。慌てて作る。

昨日注文した留学生用PCが今日届いた。素晴らしい。早速留学生さんと一緒にセットアップ。

プログラミング基礎同演習とGitHub演習のアナウンス投げた。

明日の発表スライド作った。

講義のガイダンス用の「生成AIとの付き合い方」のスライド生成した。

秋学期の講義が始まるのでバタバタする。
