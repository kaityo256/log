# ログ

[ログ一覧](index.html)

## [12月08日(水)](#08) <a id="08"></a>

論文一つ返したぞーーーー！

この論文、超絶塩漬け。手をつけたのが何年前だろ、と思って調べたら、2012年の4月頃に手をつけて、2012年9月に学会発表している。もうすぐ10年か・・・

プログラミング基礎同演習、11回の講義動画アップロードした。

```sh
pacman -Sy lib32-gcc-libs lib32-glibc
```

うーん、だめだ。gccで`func(f(1),f(2),f(3))`の結果をひっくり返せない。

## [12月07日(火)](#07) <a id="07"></a>

プログラミング基礎同演習。

[プログラミングというより物事が出来るようになる思考法](https://note.com/simplearchitect/n/n388201603a28)

重要だと思ったので。結局腰を据えて真面目にやるしかない、という身も蓋もない話。

論文を触る時間が全く取れない。

## [12月06日(月)](#06) <a id="06"></a>

第182回HPC研究発表会の座長。

ディスプレイ二台届いた。

## [12月05日(日)](#05) <a id="05"></a>

およ、学科分けとかの日記がない。またpush忘れか・・・。プロンプトに表示してても忘れるんだからなぁ。

遅レポの採点全部済ませた。

論文一つチェックして返した。

昨日の疲れを引きずっている。

昼寝したら、久しぶりに金縛り一歩手前に。あと、夢見が非常に悪かった。疲れてる。

論文もういっぺん、とりあえずブランチだけ切った。学生さんの論文に手がつけられない。富岳のチューニングもどうするんだ？

なんか、Twitter面倒になってきたなぁ。単に「へー」と思ったことを書いただけなのに変な絡み方されるし、本を読んで「わからん」って書いたら「そんなのわからないの？」みたいなこと言われるし。またしばらく休んだ方がいいかなあ。

## [12月04日(土)](#04) <a id="04"></a>

学科わけ説明会。物情はかなり頑張っていたのではないか。委員長のリーダーシップ(とセンス)が素晴らしい。

ただ、ずっと立ちっぱなし喋りっぱなしで疲れた。

```cpp
int a;
int b = ++a + ++a + ++a;
```

とあったときに、bがいくつになるか。gccでは10、clangでは9になる。

なぜgccで10になるかは、コンパイラに聞いてみるとわかる。

```cpp
int func(int a){
  return ++a + ++a + ++a;
}
```

というコードを書いて、抽象構文木をダンプしてやる。

```sh
gcc-10 -c -fdump-tree-all-graph test.c 
```

Macなのでgcc-10と指定している。すると、コンパイラがこのコードをどのように解釈したかが表示される。

まず、test.c.004t.originalがこうなる。

```cpp
int func(int a){
  return ( ++a +  ++a) +  ++a;
}
```

先に、左の`+`をまとめて実行する。これを`tmp1`でうけよう。

```cpp
int a = 1
int tmp1 = ++a +  ++a;
return tmp1 + ++a;
```

`tmp1 + ++a`は`tmp2`で受けよう。

```cpp
int a = 1
int tmp1 = ++a +  ++a;
int tmp2 = tmp1 + ++1;
return tmp2;
```

さて、前置インクリメントなので、`++a +  ++a`の+の実行前にインクリメントを実施する。

```cpp
// int tmp1 = ++a +  ++a;
a = a + 1;
a = a + 1;
int tmp1 = a + a;
int tmp2 = tmp1 + ++a;
return tmp2;
```

次に、`tmp1 + ++a`も同様に、先にインクリメントを実施する必要がある。

```cpp
// int tmp1 = ++a +  ++a;
a = a + 1;
a = a + 1;
//int tmp2 = tmp1 + ++a;
a = a + 1;
int tmp2 = tmp1 + a;
return tmp2;
```

最終的に、関数はこうなった。

```cpp
int func(int a){
  a = a + 1;
  a = a + 1;
  int tmp1 = a + a;
  a = a + 1;
  int tmp2 = tmp1 + a;
  return tmp2;  
}
```

というわけで、`a=1`の時には `++a + ++a + ++a = 3 + 3 + 4 = 10`になる。

clangの場合は9になる。どう解釈したかは、中間コードを見るとわかる。

```cpp
define i32 @func(i32 %0) #0 {
  %2 = %0  // %2 = 1
  %3 = %2  // %3 = 1
  %4 = %3 + 1 // %4 = 2
  %2 = %4     // %2 = 2
  %5 = %2     // %5 = 2
  %6 = %5 + 1 // %6 = 3
  %2 = %6     // %2 = 3
  %7 = %4 + %6 // %7 = 2 + 3 = 5
  %8 = %2      // %8 = 3
  %9 = %8 + 1  // %9 = 4
  %2 = %9
  %10 = %7 + %9 // %10 = 5 + 4
  return %10
}
```

つまり、clangの場合は`++a + ++a + ++a = 2 + 3 + 4 = 9`となる。

そもそも`++a + ++a`が、gccは6、clangは5になる。

gccは、

```cpp
a = a + 1
a = a + 1
return a + a;
```

と解釈する。clangは、

```cpp
%2 = %0 // %2 = 1
%3 = %2 // %3 = 1
%4 = %3 + 1 // %4 = 2
%2 = %4 // %2 = 2
%5 = %2 // %5 = 2
%6 = %5 + 1 // %6 = 3
%2 = %6
%7 = %4 + %6 // 2 + 3 = 5
```

つまり、

```cpp
tmp1 = a + 1
a = tmp1
tmp2 = a + 1
a = tmp2
return tmp1 + tmp2;
```

つまり、clangは、`++a`を、`tmp = a + 1;a = tmp`という形に受ける。

```cpp
int b = ++a + ++a;
```

は、

```cpp
tmp1 = a + 1;
a = tmp1;
tmp2 = a + 1;
a = tmp2;
int b = tmp1 + tmp2;
```

とバラす。gccは、

```cpp
a = a + 1
a = a + 1
int b = a + a;
```

とするので6になる。なるほど。

まとめると、`++a + ++a`とあった場合、GCCは、+の両側のインクリメント演算子を解決してからしてから加算を実行するが、clangは`++a`を`tmp = a + 1;a = tmp`にバラす。

理解できたかどうか、もう一度`++a + ++a + ++a`でやってみよう。

GCCの場合、まず、カッコをつける。

```cpp
return (++a + ++a) + ++a;
```

カッコをtmp1で受ける。

```cpp
int tmp1 = ++a + ++a;
return tmp1 + ++a;
```

`tmp1`を評価する際、まずインクリメント演算子を解決する。

```cpp
a = a + 1;
a = a + 1;
int tmp1 = a + a;
return tmp1 + ++a;
```

`tmp1 + ++a`のインクリメント演算子を解決する。

```cpp
a = a + 1;
a = a + 1;
int tmp1 = a + a;
a = a + 1:
return tmp1 + a;
```

以上から3+3+4=10になる。

clangの場合。

`++a`を`tmp = a + 1;a = tmp;`に変換。

```cpp
int tmp1 = a + 1;
a = tmp1;
return tmp1 + ++a + ++a;
```

次の`++a`も同様に変換。

```cpp
int tmp1 = a + 1;
a = tmp1;
int tmp2 = a + 1;
a = tmp2;
return tmp1 + tmp2 + ++a;
```

また変換。

```cpp
int tmp1 = a + 1;
a = tmp1;
int tmp2 = a + 1;
a = tmp2;
int tmp3 = a + 1;
a = tmp3;
return tmp1 + tmp2 + tmp3;
```

以上から2+3+4 = 9になる。うん、完全に理解した。

## [12月03日(金)](#03) <a id="03"></a>

プログラミング基礎同演習のレポート採点

学科わけの準備。

## [12月02日(木)](#02) <a id="02"></a>

あれ？12月になったってことは、この日記を丸一年つけたということか。気づかずに12月の日記を11月につけてた。

研究室ミーティング。phi4理論(スカラー場理論)の簡単な解説を探したんだけど、いまいち適当なのが無いなぁ。２つの基底状態を持つ系でキンク解を持つところまで簡単に説明した記事を書きたい(が、まったく時間がない)。

CDドライブ。AppleのSuperDriveをWindowsで使うには、AppleのサポートからBootCampをダウンロードして展開。中にあるBootCamp > Drivers > Apple > AppleODDInstaller64.exeを実行してインストール。これで使えるようになる。CDは、「ハードウェアの安全な取り出し」をするとeject可能。

動作確認のために古いCD-ROMを読み込んで見た。昔CDを買ってmp3に落とした奴。宇多田ヒカル、Noirのサントラ、Sash!、Evanescence・・・すべて懐かしい。Windows標準のプレイヤーで古すぎて読めなかったのでAIMPで開いた。

卒論の時期なので、LaTeXのセットアップについて書かないといけない。情報が古いからなんとかしないと。

`.latexmkrc`をホームディレクトリに置かせるか、各プロジェクトに置かせるか迷うな。とりあえずはホームか。

冬季安全点検送った。

LaTeXのインストール確認と、古い記述の修正を行った。卒論執筆ハンズオンの準備もOK。

第182回ハイパフォーマンスコンピューティング研究発表会、申し込んでなかったので申し込んだ。情報処理学会の年会費も払った。

## [12月01日(水)](#01) <a id="01"></a>

D論の説明。

年末調整の原本提出。枚数が多い場合は、簡単年調の台紙を使うより、A4を縦に使って、複数枚を一度に貼り付けた方が良いそうだ。来年はそうしよう。A4を縦にしたときに右上に赤字で名前と職員番号を印刷しておくこと。

面接。

柔道部ワークフローの提出。いろいろ慣れてなくて手間取った。練習が再開できる感じなので良かった。

キーボード注文したぞ。青軸派ですか。

物性研スパコンの来年度前期の申請した。

論文が共著者から返ってきた。直さないと。
