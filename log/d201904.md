# 2019年4月

## 4月30日(火)

さくらのVPS、試用期間はネームサーバの設定ができないので本登録した。
一時間ほど待つと「利用中」にステータスが変わるので、ネームサーバの登録。
無料が5ドメインある。とりあえずwwwありとなしの二つのドメインを追加。
それを学科の管理者に追加を依頼した。

## 4月26日(金)

WindowsにAnacondaを入れる。

Downloadにいって「Windowsタブ」にしてから、「Python 3.7 version」のDownloadをクリック。
Anaconda3-2019.03-Windows-x86_64.exeをダブルクリックしてインストール。死ぬほど時間がかかる。
また、初回起動もかなり時間がかかるので、あらかじめ実行しておくと良い。

Newport PMManagerを入れてみる。1918-Rはもうobsolete
https://www.newport.com/p/1919-R

ThorlabのステッピングモータをPythonから制御したければ、APT System Software。

APT 32-Bit Software for 64-BIT Windows
setup.exeを実行

Anaconda Shellを使って、 thorlabs_apt-masterのsetup.pyを実行

python setup.py install

だめだ、APT.dllが読めない。

Thorlabs Kinesisの64bit-64bitをダウンロード。

Windowsにおけるdllの検索パスはLD_LIBRARY_PATHではなくPATHらしい。

Cocoonでメニューが表示されない。php-xmlがないのが原因。

sudo yum install --enablerepo=remi,remi-php73 php-xml

## 4月25日(木)

CentOS7にPHP7を入れる。

```sh
$ sudo  yum install epel-release
パッケージ epel-release-7-11.noarch はインストール済みか最新バージョンです
何もしません
```

EPELは入ってた。次はRemi。

```sh
sudo yum -y install http://rpms.famillecollet.com/enterprise/remi-release-7.rpm
```

PHPのリポジトリが入ってるか確認。

```sh
$ ls -l /etc/yum.repos.d | grep php
-rw-r--r--  1 root root  456  3月  8 16:34 remi-php54.repo
-rw-r--r--  1 root root 1314  3月  8 16:34 remi-php70.repo
-rw-r--r--  1 root root 1314  3月  8 16:34 remi-php71.repo
-rw-r--r--  1 root root 1314  3月  8 16:34 remi-php72.repo
-rw-r--r--  1 root root 1314  3月  8 16:34 remi-php73.repo
```

入ってた。php5を消してからphp73を入れよう。

```sh
sudo yum remove remove php php-*
sudo yum install --enablerepo=remi,remi-php73 php php-mysql php-mbstring php-gd
```

どれが必要なのかわからなかったので、とりあえず必要そうなもの全部指定。

次、WordPressのCocoonテーマを入れてみる。

[https://wp-cocoon.com/downloads/](https://wp-cocoon.com/downloads/)の「Cocoonテーマ」から
親テーマと子テーマをダウンロード。[https://wp-cocoon.com/theme-install/](https://wp-cocoon.com/theme-install/)の手順に従って入れる。

そうしたら「アップロードしたファイルは php.ini で定義された upload_max_filesize を超過しています。」とと文句を言われたので、`/etc/php.ini`の当該項目を

```ini
upload_max_filesize = 8M
```

に修正。できた。あとはCSSを修正しながら様子を見る感じで。

## 4月23日(火)

さくらVPSにWordpressを入れる。

```sh
sudo yum install httpd mysql-server php php-mysql wget
sudo yum install mariadb mariadb-server
sudo systemctl start mariadb
sudo systemctl enable mariadb
mysql -u root
MariaDB [(none)]> update mysql.user set password=password('rootパスワード入力') where user = 'root';
MariaDB [(none)]> flush privileges;
MariaDB [(none)]> exit;
# mysql -u root -p
# Enter password:
MariaDB [(none)]> create database wordpress;
MariaDB [(none)]> show databases;
MariaDB [(none)]> exit;
```

```sh
mkdir build
cd build
wget https://ja.wordpress.org/latest-ja.zip
unzip latest-ja.zip
```

## 4月22日(月)

さくらにVPSサーバを立てた。

* とりあえずPermitRootLoginをno
* ユーザ作成
* httpdのインストール
* /etc/httpd/conf.d/security.confで

```conf
ServerTokens Prod
```

* dockerのインストール

```sh
sudo yum install docker
```

* Pythonのインストール

```sh
sudo yum install python36 python36-pip
sudo ln -s /usr/bin/pip3.6 /usr/local/bin/pip
sudo /usr/local/bin/pip install pipenv 
```

* dockerファイルの場所でpipenvする

```sh
mkdir www
cd www
# docker-compose.ymlを作成
pipenv install docker-compose
pipenv shell
```

docker-compose upしてみる。

```sh
$ docker-compose up
ERROR: Couldn't connect to Docker daemon at http+docker://localhost - is it running?

If it's at a non-standard location, specify the URL with the DOCKER_HOST environment variable.
(www)
```

dockerのパーミッションが足りない。sudoでやりたくなければ、ユーザをdockerグループに所属させる。

```sh
sudo groupadd docker
sudo gpasswd -a $USER docker
sudo systemctl restart docker
```

一度ログアウトして、再度ログインするとdocker-compose upできるようになる。
しかし、mysqlに接続できない。firewallにmysqlを追加する。

```sh
sudo firewall-cmd --add-service=mysql --zone=public --permanent
```

だめだ。やりなおし。

```sh
mv www www2
mkdir www
cd www
docker pull mysql:5.7.21
docker pull wordpress
docker run --name test-mysql -e MYSQL_ROOT_PASSWORD=test-pw -d mysql:5.7.21
docker run --name test-wordpress --link test-mysql:mysql -d -p 8080:80 wordpress
```

だめだ。どうしてもデータベースにアクセスできない。まずローカルで試すか。

```sh
brew install docker
brew cask install docker
open /Applications/Docker.app
```

このあと、docker psが帰ってくるまでまつ。

```sh
mkdir www
cd www
docker pull mysql:5.7.21
docker pull wordpress
docker run --name test-mysql -e MYSQL_ROOT_PASSWORD=test-pw -d mysql:5.7.21
docker run --name test-wordpress --link test-mysql:mysql -d -p 8080:80 wordpress
```

run時にイメージがなかったらどうせダウンロードしてくれるから、docker pullいらんかったな。
うーん、ローカルではあっさり動いたなぁ。

もう一度さくらでやったらあっさり動いた。何がわるかったんだ？mysqlのポートか？

## 4月2日(火)

Zulipにアカウントを作る。

https://zulipchat.com/new/

で、自分のメールアドレスを入力。
メールを受け取ったら、Organizationの名前や説明を生成。
Hostingする場合は hogehoge.zulipchat.comというURLになる。

Slackと同じような感じで使えるっぽい？
